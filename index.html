<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äº’åŠ¨æŠ•ç¥¨</title>
    <!-- å¼•å…¥ Supabase/MemFire SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    <style>
        :root { 
            --primary: #07c160; /* å¾®ä¿¡é£æ ¼ç»¿ */
            --primary-dark: #05a150;
            --bg: #f5f6f7; 
            --card: #ffffff; 
            --text: #1a1a1a; 
            --tag-bg: #e8fce8;
            --tag-text: #058a42;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, Arial, sans-serif; background-color: var(--bg); color: var(--text); padding-bottom: 60px; }
        .container { max-width: 800px; margin: 0 auto; padding: 15px; }
        
        /* === åŸºç¡€ç»„ä»¶ === */
        .btn { padding: 12px 20px; border-radius: 8px; border: none; font-size: 16px; font-weight: 600; color: white; width: 100%; cursor: pointer; transition: 0.2s; }
        .btn-primary { background: var(--primary); box-shadow: 0 4px 12px rgba(7, 193, 96, 0.2); }
        .btn-primary:active { background: var(--primary-dark); transform: scale(0.98); }
        .btn-outline { background: white; border: 1px solid #ddd; color: #666; width: auto; font-size: 14px; padding: 6px 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; outline: none; }
        .input:focus { border-color: var(--primary); }
        
        /* === å¡ç‰‡ä¸å¸ƒå±€ === */
        .card { background: var(--card); padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); position: relative; }
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        
        /* === ç”¨æˆ·é€‰é¡¹æ ·å¼ (é‡ç‚¹ä¼˜åŒ–) === */
        .opt-grid { display: flex; flex-direction: column; gap: 12px; margin: 20px 0; }
        .opt-btn { 
            background: #f8f9fa; border: 2px solid transparent; padding: 15px; border-radius: 10px; 
            text-align: left; font-size: 16px; color: #333; position: relative; transition: all 0.2s;
            display: flex; align-items: center; justify-content: space-between;
        }
        /* é€‰ä¸­çŠ¶æ€ */
        .opt-btn.selected { 
            background: #f0fdf4; border-color: var(--primary); color: var(--primary-dark); font-weight: bold; 
            box-shadow: 0 0 0 2px rgba(7, 193, 96, 0.1);
        }
        /* é€‰ä¸­æ—¶çš„å¯¹å‹¾å›¾æ ‡ */
        .opt-btn.selected::after {
            content: "âœ“"; font-weight: 900; font-size: 18px; color: var(--primary);
        }

        /* === ç®¡ç†å‘˜ç»“æœæ ·å¼ (é‡ç‚¹ä¼˜åŒ–) === */
        .admin-result-box { margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px; }
        .result-item { margin-bottom: 20px; }
        .result-header { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 14px; font-weight: bold; color: #444; }
        .progress-bg { background: #eee; height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 8px; }
        .progress-bar { background: var(--primary); height: 100%; width: 0; transition: width 0.5s; }
        
        /* åå­—å¢™æ ·å¼ */
        .voter-wall { display: flex; flex-wrap: wrap; gap: 6px; }
        .voter-tag { 
            background: #f0f2f5; color: #555; font-size: 12px; padding: 4px 10px; 
            border-radius: 15px; border: 1px solid #e1e4e8;
        }

        /* === æ¨¡æ€æ¡† === */
        .modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:none; justify-content:center; align-items:center; z-index:1000; backdrop-filter: blur(2px); }
        .modal-box { background:white; width:85%; max-width:400px; padding:25px; border-radius: 16px; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* Toast & Loading */
        #loading { position:fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:2000; display:flex; justify-content:center; align-items:center; flex-direction:column; color: var(--primary); }
        .toast { position:fixed; bottom:40px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.8); color:white; padding:10px 24px; border-radius: 30px; font-size: 14px; display:none; z-index:3000; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    </style>
</head>
<body>

    <!-- å…¨å±€åŠ è½½é®ç½© -->
    <div id="loading">
        <div style="font-size:18px; font-weight:bold; margin-bottom:10px;">ç³»ç»ŸåŠ è½½ä¸­...</div>
        <div style="font-size:12px; color:#999;">æ­£åœ¨è¿æ¥å›½å†…æœåŠ¡å™¨</div>
    </div>

    <!-- 1. ç™»å½•å¼¹çª— (å¼ºåˆ¶) -->
    <div id="login-modal" class="modal" style="display:flex; background:white; z-index:1500;">
        <div style="text-align:center; width:80%; max-width:320px;">
            <h2 style="color:var(--primary); margin-bottom:10px;">ğŸ‘‹ æ¬¢è¿åŠ å…¥æŠ•ç¥¨</h2>
            <p style="color:#666; font-size:13px; margin-bottom:20px;">è¯·è¾“å…¥æ‚¨çš„å§“åä»¥ä¾¿å¤§å®¶è®¤è¯†ä½ </p>
            <input type="text" id="username" class="input" placeholder="ä½ çš„å§“å" style="text-align:center; margin-bottom:15px;">
            <button onclick="handleLogin()" class="btn btn-primary">å¼€å§‹ä½¿ç”¨</button>
        </div>
    </div>

    <!-- 2. ä¸»ç•Œé¢ -->
    <div class="container" id="app" style="display:none;">
        <!-- é¡¶éƒ¨ä¿¡æ¯ -->
        <div class="header-bar">
            <div style="display:flex; align-items:center; gap:8px;">
                <div style="width:36px; height:36px; background:var(--primary); color:white; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold;" id="avatar">U</div>
                <div>
                    <div id="u-name" style="font-weight:bold; font-size:15px; line-height:1.2;">ç”¨æˆ·</div>
                    <div id="role-tag" style="font-size:11px; color:#888;">æ™®é€šæˆå‘˜</div>
                </div>
            </div>
            <button onclick="showAuth()" class="btn btn-outline">ç®¡ç†/æŠ•å±</button>
        </div>

        <!-- ç®¡ç†å‘˜é¢æ¿ -->
        <div id="admin-box" class="card" style="background:#ebf8f2; border:1px solid #d1e7dd; display:none;">
            <h4 style="margin-bottom:15px; color:#0f5132;">ğŸ›  ç®¡ç†å‘˜æ§åˆ¶å°</h4>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <button onclick="openAddModal()" class="btn btn-primary" style="font-size:14px;">+ æ–°å¢é¢˜ç›®</button>
                <button onclick="copyLink()" class="btn btn-primary" style="font-size:14px; background:#7c3aed;">ğŸ”— å¤åˆ¶é“¾æ¥</button>
                <button onclick="syncData(true)" class="btn btn-outline" style="background:white;">ğŸ”„ åˆ·æ–°æ•°æ®</button>
                <button onclick="clearVotes()" class="btn btn-outline" style="background:white; color:#dc3545; border-color:#dc3545;">ğŸ—‘ æ¸…ç©ºæœ¬é¢˜æŠ•ç¥¨</button>
            </div>
            <div style="margin-top:10px; font-size:12px; color:#666; text-align:center;">
                å½“å‰æˆ¿é—´ID: <span id="current-id" style="font-family:monospace; background:white; padding:2px 5px; border-radius:4px;">-</span>
            </div>
        </div>

        <!-- é¢˜ç›®åˆ—è¡¨åŒºåŸŸ -->
        <div id="quiz-list"></div>
    </div>

    <!-- 3. æ·»åŠ é¢˜ç›®å¼¹çª— -->
    <div id="edit-modal" class="modal">
        <div class="modal-box">
            <h3 style="margin-bottom:15px;">å‘å¸ƒæ–°æŠ•ç¥¨</h3>
            <label style="font-size:12px; color:#666;">é¢˜ç›®å†…å®¹</label>
            <input id="q-title" class="input" placeholder="ä¾‹å¦‚ï¼šä»Šæ™šèšé¤åƒä»€ä¹ˆï¼Ÿ" style="margin-bottom:15px;">
            
            <label style="font-size:12px; color:#666;">é€‰é¡¹ (è‡ªåŠ¨è¿‡æ»¤ç©ºè¡Œ)</label>
            <div id="q-opts" style="max-height:200px; overflow-y:auto; margin-bottom:10px;"></div>
            <button onclick="addOptLine()" class="btn btn-outline" style="width:100%; border-style:dashed;">+ æ·»åŠ é€‰é¡¹</button>
            
            <div style="display:flex; gap:10px; margin-top:20px;">
                <button onclick="closeModal('edit-modal')" class="btn btn-outline" style="flex:1">å–æ¶ˆ</button>
                <button onclick="saveToCloud()" class="btn btn-primary" style="flex:1">å‘å¸ƒ</button>
            </div>
        </div>
    </div>

    <!-- 4. æƒé™éªŒè¯å¼¹çª— -->
    <div id="auth-modal" class="modal">
        <div class="modal-box" style="text-align:center;">
            <h3 style="margin-bottom:15px;">åˆ‡æ¢èº«ä»½</h3>
            <input type="password" id="pwd" class="input" placeholder="è¾“å…¥å¯†ç  (admin123)" style="margin-bottom:15px; text-align:center;">
            <button onclick="checkAuth()" class="btn btn-primary">ç¡®è®¤ç™»å½•</button>
            <button onclick="closeModal('auth-modal')" class="btn btn-outline" style="margin-top:10px; border:none;">å–æ¶ˆ</button>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        // ==========================================
        // ã€é…ç½®åŒºã€‘è¯·åŠ¡å¿…ä¿®æ”¹è¿™é‡Œ
        // ==========================================
        const MEMFIRE_URL = 'https://d4g6fdgg91htqli3u7sg.baseapi.memfiredb.com';
        const MEMFIRE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImV4cCI6MzM0MDUzMTM4MiwiaWF0IjoxNzYzNzMxMzgyLCJpc3MiOiJzdXBhYmFzZSJ9.fsVIuQNlARfMnBzz3GkhfnQa6nAemjRiMta_nPvNqro';
        // ==========================================

        const { createClient } = supabase;
        let db = null;
        
        let state = {
            user: localStorage.getItem('wx_vote_user_v2') || '',
            role: 'user', // user, admin
            pageId: new URLSearchParams(location.search).get('id'),
            data: { questions: [], votes: {} },
            temp: {} 
        };

        // ç³»ç»Ÿåˆå§‹åŒ–
        window.onload = async function() {
            if(MEMFIRE_URL.includes('è¿™é‡Œå¡«')) {
                alert('è¯·å…ˆåœ¨ä»£ç ä¸­å¡«å…¥ MemFire æ•°æ®åº“é…ç½®ï¼');
                return;
            }
            
            db = createClient(MEMFIRE_URL, MEMFIRE_KEY);
            
            if(state.user) {
                document.getElementById('login-modal').style.display = 'none';
                initApp();
            } else {
                document.getElementById('loading').style.display = 'none';
            }
        };

        // ç™»å½•é€»è¾‘
        function handleLogin() {
            const name = document.getElementById('username').value.trim();
            if(!name) return showToast('åå­—ä¸èƒ½ä¸ºç©º');
            state.user = name;
            localStorage.setItem('wx_vote_user_v2', name);
            location.reload();
        }

        // åº”ç”¨å¯åŠ¨
        async function initApp() {
            document.getElementById('app').style.display = 'block';
            document.getElementById('u-name').textContent = state.user;
            document.getElementById('avatar').textContent = state.user.substring(0,1).toUpperCase();
            
            if(!state.pageId) {
                // å¦‚æœæ²¡æœ‰IDï¼Œè¯´æ˜æ˜¯é¦–é¡µ
                document.getElementById('loading').style.display = 'none';
                if(state.role === 'user') {
                    document.getElementById('quiz-list').innerHTML = `
                        <div style="text-align:center; padding:60px 20px; color:#999;">
                            <div style="font-size:40px; margin-bottom:10px;">ğŸ“­</div>
                            <p>è¿˜æ²¡æœ‰é¢˜ç›®å“¦</p>
                            <p style="font-size:12px;">è¯·è”ç³»ç®¡ç†å‘˜åˆ†äº«æ–°çš„é“¾æ¥</p>
                        </div>`;
                }
            } else {
                // æ‹‰å–æ•°æ®
                await loadData();
            }
        }

        // --- æ•°æ®åº“æ“ä½œ ---

        async function loadData() {
            document.getElementById('loading').style.display = 'flex';
            try {
                const { data, error } = await db.from('quizzes').select('*').eq('id', state.pageId).single();
                
                if(data) {
                    state.data.questions = data.content || [];
                    state.data.votes = data.votes || {};
                    document.getElementById('current-id').textContent = state.pageId;
                }
                render();
            } catch(e) {
                console.error(e);
                showToast('æ•°æ®åŠ è½½å¼‚å¸¸');
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        async function saveToCloud(refresh = true) {
            const title = document.getElementById('q-title').value.trim();
            // è·å–é€‰é¡¹å¹¶å»é‡å»ç©º
            const optInputs = document.querySelectorAll('.opt-input');
            const opts = Array.from(optInputs).map(i => i.value.trim()).filter(v=>v);
            
            if(!state.pageId) state.pageId = Date.now().toString(); // æ–°å»ºID

            if(refresh) {
                if(!title || opts.length < 2) return alert('è¯·å¡«å†™æ ‡é¢˜å¹¶è‡³å°‘æ·»åŠ 2ä¸ªé€‰é¡¹');
                const newQ = { id: Date.now().toString(), title, options: opts };
                state.data.questions.unshift(newQ); // æ–°é¢˜æ’åˆ°æœ€å‰
            }

            document.getElementById('loading').style.display = 'flex';
            
            const payload = {
                id: state.pageId,
                title: 'é—®å· ' + state.pageId,
                content: state.data.questions,
                votes: state.data.votes
            };

            const { error } = await db.from('quizzes').upsert(payload);
            
            document.getElementById('loading').style.display = 'none';
            if(error) {
                alert('ä¿å­˜å¤±è´¥: ' + error.message);
            } else {
                if(refresh) {
                    const newUrl = location.pathname + '?id=' + state.pageId;
                    history.replaceState({}, '', newUrl);
                    closeModal('edit-modal');
                    render();
                    showToast('å‘å¸ƒæˆåŠŸï¼');
                }
            }
        }

        async function submitVote(qid) {
            const sels = state.temp[qid];
            if(!sels || sels.length === 0) return showToast('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªé€‰é¡¹');

            document.getElementById('loading').style.display = 'flex';

            // 1. æ‹‰å–æœ€æ–°é˜²æ­¢å†²çª
            const { data: latest } = await db.from('quizzes').select('votes').eq('id', state.pageId).single();
            let cloudVotes = latest?.votes || state.data.votes || {};

            if(!cloudVotes[qid]) cloudVotes[qid] = {};
            
            // 2. å†™å…¥æŠ•ç¥¨
            sels.forEach(opt => {
                if(!cloudVotes[qid][opt]) cloudVotes[qid][opt] = [];
                // ç®€å•çš„å»é‡ï¼šå¦‚æœå·²ç»åœ¨é‡Œé¢äº†å°±ä¸åŠ äº†ï¼ˆæˆ–è€…å…ˆå‰”é™¤å†åŠ ï¼Œè¿™é‡Œé‡‡ç”¨è¿½åŠ å‰æ£€æŸ¥ï¼‰
                if(!cloudVotes[qid][opt].includes(state.user)) {
                    cloudVotes[qid][opt].push(state.user);
                }
            });

            // 3. æ›´æ–°
            const { error } = await db.from('quizzes').update({ votes: cloudVotes }).eq('id', state.pageId);

            document.getElementById('loading').style.display = 'none';
            if(error) {
                alert('æŠ•ç¥¨å¤±è´¥ï¼Œè¯·é‡è¯•');
            } else {
                state.data.votes = cloudVotes;
                delete state.temp[qid];
                showToast('æŠ•ç¥¨æˆåŠŸ ğŸ‰');
                render();
            }
        }

        async function clearVotes() {
            if(!confirm('ç¡®å®šè¦æ¸…ç©ºå½“å‰é¡µé¢çš„æ‰€æœ‰æŠ•ç¥¨è®°å½•å—ï¼Ÿ(é¢˜ç›®ä¿ç•™)')) return;
            state.data.votes = {};
            await saveToCloud(false); // falseè¡¨ç¤ºä¸æ–°å¢é¢˜ç›®ï¼Œåªå­˜çŠ¶æ€
            render();
            showToast('æŠ•ç¥¨è®°å½•å·²æ¸…ç©º');
        }

        // --- æ ¸å¿ƒæ¸²æŸ“é€»è¾‘ ---

        function render() {
            const container = document.getElementById('quiz-list');
            container.innerHTML = '';
            
            if(state.data.questions.length === 0) return;

            state.data.questions.forEach(q => {
                const myVotes = getMyVotes(q.id);
                const hasVoted = myVotes.length > 0;
                const isAdmin = state.role === 'admin';

                // 1. é€‰é¡¹æ¸²æŸ“
                let optsHtml = '<div class="opt-grid">';
                q.options.forEach(opt => {
                    // åˆ¤æ–­é€‰ä¸­çŠ¶æ€ï¼šå¦‚æœæ˜¯ä¸´æ—¶é€‰æ‹© OR å·²ç»æŠ•è¿‡çš„
                    const isSelected = state.temp[q.id]?.includes(opt) || myVotes.includes(opt);
                    // å¦‚æœå·²æŠ•è¿‡ï¼Œç¦æ­¢ç‚¹å‡»
                    const clickAction = hasVoted ? '' : `onclick="toggleOpt('${q.id}', '${opt}')"`;
                    
                    optsHtml += `
                        <div class="opt-btn ${isSelected ? 'selected' : ''}" ${clickAction}>
                            <span>${opt}</span>
                        </div>`;
                });
                optsHtml += '</div>';

                // 2. æŒ‰é’®åŒºåŸŸ
                let btnHtml = '';
                if(!hasVoted) {
                    btnHtml = `<button onclick="submitVote('${q.id}')" class="btn btn-primary">ç¡®è®¤æäº¤</button>`;
                } else {
                    btnHtml = `<button class="btn btn-primary" disabled style="background:#bbf7d0; color:#166534; cursor:default;">å·²å®ŒæˆæŠ•ç¥¨</button>`;
                }

                // 3. ç»“æœå±•ç¤º (Admin/Presenter ä¸“å±è§†å›¾)
                let resultHtml = '';
                if(isAdmin) {
                    const qVotes = state.data.votes[q.id] || {};
                    // è®¡ç®—æ€»ç¥¨æ•°
                    let totalVotes = 0;
                    Object.values(qVotes).forEach(arr => totalVotes += arr.length);

                    resultHtml += `<div class="admin-result-box">`;
                    q.options.forEach(opt => {
                        const voters = qVotes[opt] || [];
                        const count = voters.length;
                        const pct = totalVotes ? Math.round((count/totalVotes)*100) : 0;
                        
                        // ç”Ÿæˆåå­—æ ‡ç­¾
                        let namesHtml = voters.map(name => `<span class="voter-tag">${name}</span>`).join('');
                        if(!namesHtml) namesHtml = '<span style="font-size:12px; color:#ccc;">æš‚æ— </span>';

                        resultHtml += `
                            <div class="result-item">
                                <div class="result-header">
                                    <span>${opt}</span>
                                    <span>${count} ç¥¨ (${pct}%)</span>
                                </div>
                                <div class="progress-bg"><div class="progress-bar" style="width:${pct}%"></div></div>
                                <div class="voter-wall">${namesHtml}</div>
                            </div>
                        `;
                    });
                    resultHtml += `</div>`;
                    
                    // ç®¡ç†å‘˜åˆ é™¤æŒ‰é’®
                    btnHtml = `<div style="display:flex; justify-content:flex-end; margin-top:-10px; margin-bottom:10px;">
                                <button onclick="deleteQ('${q.id}')" style="font-size:12px; color:#ff4d4f; background:none; border:none;">âŒ åˆ é™¤æ­¤é¢˜</button>
                               </div>` + resultHtml; 
                }

                // ç»„è£…å¡ç‰‡
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h3 style="font-size:18px; margin-bottom:5px;">${q.title}</h3>
                    <div style="font-size:12px; color:#999; margin-bottom:10px;">å¤šé€‰æ¨¡å¼</div>
                    ${optsHtml}
                    ${btnHtml}
                `;
                container.appendChild(card);
            });
        }

        // --- äº¤äº’ ---

        function toggleOpt(qid, opt) {
            if(!state.temp[qid]) state.temp[qid] = [];
            const idx = state.temp[qid].indexOf(opt);
            if(idx > -1) state.temp[qid].splice(idx, 1); // å–æ¶ˆ
            else state.temp[qid].push(opt); // é€‰ä¸­
            render(); // è§¦å‘é‡ç»˜ï¼Œæ˜¾ç¤ºé€‰ä¸­çŠ¶æ€
        }

        function getMyVotes(qid) {
            const v = state.data.votes[qid];
            if(!v) return [];
            return Object.keys(v).filter(k => v[k].includes(state.user));
        }

        // --- ç®¡ç†åŠŸèƒ½ ---

        function showAuth() { document.getElementById('auth-modal').style.display = 'flex'; }
        function checkAuth() {
            if(document.getElementById('pwd').value === 'admin123' || document.getElementById('pwd').value === 'presenter123') {
                state.role = 'admin';
                document.getElementById('role-tag').textContent = 'ç®¡ç†å‘˜/æ¼”ç¤ºè€…';
                document.getElementById('admin-box').style.display = 'block';
                closeModal('auth-modal');
                render();
                showToast('å·²è¿›å…¥ç®¡ç†æ¨¡å¼');
            } else { showToast('å¯†ç é”™è¯¯'); }
        }

        function openAddModal() {
            document.getElementById('q-title').value = '';
            document.getElementById('q-opts').innerHTML = '';
            addOptLine(); addOptLine();
            document.getElementById('edit-modal').style.display = 'flex';
        }
        function addOptLine() {
            const div = document.createElement('div');
            div.innerHTML = `<input class="input opt-input" style="margin-bottom:8px; padding:10px;" placeholder="é€‰é¡¹å†…å®¹">`;
            document.getElementById('q-opts').appendChild(div);
        }

        async function deleteQ(qid) {
            if(!confirm('ç¡®å®šåˆ é™¤æ­¤é¢˜ï¼Ÿ')) return;
            state.data.questions = state.data.questions.filter(q => q.id !== qid);
            delete state.data.votes[qid]; // æ¸…ç†æ•°æ®
            await saveToCloud(false);
            render();
        }

        function syncData(manual) { loadData(); if(manual) showToast('å·²åŒæ­¥æœ€æ–°ç»“æœ'); }
        
        function copyLink() {
            if(!state.pageId) return showToast('è¯·å…ˆå‘å¸ƒé¢˜ç›®');
            const url = location.href;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(url).then(() => showToast('é“¾æ¥å·²å¤åˆ¶ï¼Œå‘ç»™å¾®ä¿¡å¥½å‹å§'));
            } else {
                prompt("è¯·å¤åˆ¶é“¾æ¥ï¼š", url);
            }
        }

        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg; t.style.display = 'block';
            setTimeout(()=>t.style.display='none', 2000);
        }
    </script>
</body>
</html>
